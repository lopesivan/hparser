format is internally known by the program.  pre-assemble tree then use ExpandData and CollectData.